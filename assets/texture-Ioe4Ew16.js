import{af as F,O as U,E as z,e as x,S as b,_ as o,s as l,b as W,f as C,ag as G,g as v,h as S,ah as Y,ai as k,aj as j,Q as q,R as H}from"./index-DjxoVRif.js";class p{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let e=this.width|0;return e=e*397^(this.height|0),e}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new p(this.width*e,this.height*t)}clone(){return new p(this.width,this.height)}equals(e){return e?this.width===e.width&&this.height===e.height:!1}get surface(){return this.width*this.height}static Zero(){return new p(0,0)}add(e){return new p(this.width+e.width,this.height+e.height)}subtract(e){return new p(this.width-e.width,this.height-e.height)}scale(e){return new p(this.width*e,this.height*e)}static Lerp(e,t,i){const a=e.width+(t.width-e.width)*i,h=e.height+(t.height-e.height)*i;return new p(a,h)}}class N{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return this._texture?this._texture.isCube:!1}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return(e==null?void 0:e.shareDepth)!==void 0}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=p.Zero(),this._cachedBaseSize=p.Zero(),this._initialSamplingMode=2,this._texture=N._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return this.delayLoadState===4?(this.delayLoad(),!1):this._texture?this._texture.isReady:!1}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return!this.isReady()||!this._texture?(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize):this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}class d extends N{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){if(this._texture)this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace);else return this._gammaSpace;return this._texture._gammaSpace&&!this._texture._useSRGBBuffer}set gammaSpace(e){var t;if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}(t=this.getScene())==null||t.markAllMaterialsAsDirty(1,i=>i.hasTexture(this))}get isRGBD(){return this._texture!=null&&this._texture._isRGBD}set isRGBD(e){var t;e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),(t=this.getScene())==null||t.markAllMaterialsAsDirty(1,i=>i.hasTexture(this)))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return this._texture?this._texture._linearSpecularLOD:!1}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=F()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e,t=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=d.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new U,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?d._IsScene(e)?this._scene=e:this._engine=e:this._scene=z.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return x.IdentityReadOnly}getReflectionTextureMatrix(){return x.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,i,a,h,_){const f=this._getEngine();if(!f)return null;const n=f._getUseSRGBBuffer(!!h,t),r=f.getLoadedTexturesCache();for(let u=0;u<r.length;u++){const c=r[u];if((h===void 0||n===c._useSRGBBuffer)&&(a===void 0||a===c.invertY)&&c.url===e&&c.generateMipMaps===!t&&(!i||i===c.samplingMode)&&(_===void 0||_===c.isCube))return c.incrementReferences(),c}return null}_rebuild(e=!1){}clone(){return null}get textureType(){return this._texture&&this._texture.type!==void 0?this._texture.type:0}get textureFormat(){return this._texture&&this._texture.format!==void 0?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,i=null,a=!0,h=!1,_=0,f=0,n=Number.MAX_VALUE,r=Number.MAX_VALUE){if(!this._texture)return null;const u=this._getEngine();if(!u)return null;const c=this.getSize();let R=c.width,m=c.height;t!==0&&(R=R/Math.pow(2,t),m=m/Math.pow(2,t),R=Math.round(R),m=Math.round(m)),n=Math.min(R,n),r=Math.min(m,r);try{return this._texture.isCube?u._readTexturePixels(this._texture,n,r,e,t,i,a,h,_,f):u._readTexturePixels(this._texture,n,r,-1,t,i,a,h,_,f)}catch{return null}}_readPixelsSync(e=0,t=0,i=null,a=!0,h=!1){if(!this._texture)return null;const _=this.getSize();let f=_.width,n=_.height;const r=this._getEngine();if(!r)return null;t!=0&&(f=f/Math.pow(2,t),n=n/Math.pow(2,t),f=Math.round(f),n=Math.round(n));try{return this._texture.isCube?r._readTexturePixelsSync(this._texture,f,n,e,t,i,a,h):r._readTexturePixelsSync(this._texture,f,n,-1,t,i,a,h)}catch{return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;const t=b.Serialize(this);return b.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let i=e.length;if(i===0){t();return}for(let a=0;a<e.length;a++){const h=e[a];if(h.isReady())--i===0&&t();else{const _=h.onLoadObservable;_?_.addOnce(()=>{--i===0&&t()}):--i===0&&t()}}}static _IsScene(e){return e.getClassName()==="Scene"}}d.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4;o([l()],d.prototype,"uniqueId",void 0);o([l()],d.prototype,"name",void 0);o([l()],d.prototype,"displayName",void 0);o([l()],d.prototype,"metadata",void 0);o([l("hasAlpha")],d.prototype,"_hasAlpha",void 0);o([l("getAlphaFromRGB")],d.prototype,"_getAlphaFromRGB",void 0);o([l()],d.prototype,"level",void 0);o([l("coordinatesIndex")],d.prototype,"_coordinatesIndex",void 0);o([l()],d.prototype,"optimizeUVAllocation",void 0);o([l("coordinatesMode")],d.prototype,"_coordinatesMode",void 0);o([l()],d.prototype,"wrapU",null);o([l()],d.prototype,"wrapV",null);o([l()],d.prototype,"wrapR",void 0);o([l()],d.prototype,"anisotropicFilteringLevel",void 0);o([l()],d.prototype,"isCube",null);o([l()],d.prototype,"is3D",null);o([l()],d.prototype,"is2DArray",null);o([l()],d.prototype,"gammaSpace",null);o([l()],d.prototype,"invertZ",void 0);o([l()],d.prototype,"lodLevelInAlpha",void 0);o([l()],d.prototype,"lodGenerationOffset",null);o([l()],d.prototype,"lodGenerationScale",null);o([l()],d.prototype,"linearSpecularLOD",null);o([W()],d.prototype,"irradianceTexture",null);o([l()],d.prototype,"isRenderTarget",void 0);function P(g,e,t=!1){const i=e.width,a=e.height;if(g instanceof Float32Array){let r=g.byteLength/g.BYTES_PER_ELEMENT;const u=new Uint8Array(r);for(;--r>=0;){let c=g[r];c<0?c=0:c>1&&(c=1),u[r]=c*255}g=u}const h=document.createElement("canvas");h.width=i,h.height=a;const _=h.getContext("2d");if(!_)return null;const f=_.createImageData(i,a);if(f.data.set(g),_.putImageData(f,0,0),t){const r=document.createElement("canvas");r.width=i,r.height=a;const u=r.getContext("2d");return u?(u.translate(0,a),u.scale(1,-1),u.drawImage(h,0,0),r.toDataURL("image/png")):null}return h.toDataURL("image/png")}function Z(g,e=0,t=0){const i=g.getInternalTexture();if(!i)return null;const a=g._readPixelsSync(e,t);return a?P(a,g.getSize(),i.invertY):null}async function X(g,e=0,t=0){const i=g.getInternalTexture();if(!i)return null;const a=await g.readPixels(e,t);return a?P(a,g.getSize(),i.invertY):null}class s extends d{static _CreateVideoTexture(e,t,i,a=!1,h=!1,_=s.TRILINEAR_SAMPLINGMODE,f={},n,r=5){throw C("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,i,a,h=s.TRILINEAR_SAMPLINGMODE,_=null,f=null,n=null,r=!1,u,c,R,m,w){super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new U,this._isBlocking=!0,this.name=e||"",this.url=e;let A,L=!1,O=null,D=!0;typeof i=="object"&&i!==null?(A=i.noMipmap??!1,a=i.invertY??!0,h=i.samplingMode??s.TRILINEAR_SAMPLINGMODE,_=i.onLoad??null,f=i.onError??null,n=i.buffer??null,r=i.deleteBuffer??!1,u=i.format,c=i.mimeType,R=i.loaderOptions,m=i.creationFlags,L=i.useSRGBBuffer??!1,O=i.internalTexture??null,D=i.gammaSpace??D,w=i.forcedExtension??w):A=!!i,this._gammaSpace=D,this._noMipmap=A,this._invertY=a===void 0?!0:a,this._initialSamplingMode=h,this._buffer=n,this._deleteBuffer=r,this._mimeType=c,this._loaderOptions=R,this._creationFlags=m,this._useSRGBBuffer=L,this._forcedExtension=w,u!==void 0&&(this._format=u);const y=this.getScene(),B=this._getEngine();if(!B)return;B.onBeforeTextureInitObservable.notifyObservers(this);const I=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),this._texture._cachedWrapU!==null&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),this._texture._cachedWrapV!==null&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),this._texture._cachedWrapR!==null&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),_&&_(),!this.isBlocking&&y&&y.resetCachedMaterial()},E=(M,T)=>{this._loadingError=!0,this._errorObject={message:M,exception:T},f&&f(M,T),s.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!O){this._delayedOnLoad=I,this._delayedOnError=E;return}if(this._texture=O??this._getFromCache(this.url,A,h,this._invertY,L,this.isCube),this._texture)if(this._texture.isReady)G.SetImmediate(()=>I());else{const M=this._texture.onLoadedObservable.add(I);this._texture.onErrorObservable.add(T=>{var V;E(T.message,T.exception),(V=this._texture)==null||V.onLoadedObservable.remove(M)})}else if(!y||!y.useDelayedTextureLoading){try{this._texture=B.createTexture(this.url,A,this._invertY,y,h,I,E,this._buffer,void 0,this._format,this._forcedExtension,c,R,m,L)}catch(M){throw E("error loading",M),M}r&&(this._buffer=null)}else this.delayLoadState=4,this._delayedOnLoad=I,this._delayedOnError=E}updateURL(e,t=null,i,a){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,h=>h.hasTexture(this))),(!this.name||this.name.startsWith("data:"))&&(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=a,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(this.delayLoadState!==4)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?G.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,i,a){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,v.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,a),a.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,a.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,a.z+=this.wRotationCenter}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,(!this._cachedTextureMatrix||!this._rowGenerationMatrix)&&(this._cachedTextureMatrix=x.Zero(),this._rowGenerationMatrix=new x,this._t0=v.Zero(),this._t1=v.Zero(),this._t2=v.Zero()),x.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(x.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,S.Matrix[0]),x.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,S.Matrix[1]),x.ScalingToRef(this._cachedUScale,this._cachedVScale,0,S.Matrix[2]),x.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,S.Matrix[3]),S.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(S.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(S.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(S.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),x.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();if(!t)return this._cachedTextureMatrix;const i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,a=>a.hasTexture(this)),this._cachedTextureMatrix}getReflectionTextureMatrix(){const e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode)if(this.coordinatesMode===s.PROJECTION_MODE){if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}else return this._cachedReflectionTextureMatrix;this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=x.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=x.Zero());const t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case s.PLANAR_MODE:{x.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break}case s.PROJECTION_MODE:{x.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const i=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=i.updateFlag,i.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:x.IdentityToRef(this._cachedReflectionTextureMatrix);break}return t&&e.markAllMaterialsAsDirty(1,i=>i.hasTexture(this)),this._cachedReflectionTextureMatrix}clone(){const e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return b.Clone(()=>new s(this._texture?this._texture.url:null,this.getScene(),e),this)}serialize(){var i,a;const e=this.name;s.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const t=super.serialize(s._SerializeInternalTextureUniqueId);if(!t)return null;if(s.SerializeBuffers||s.ForceSerializeBuffers)if(typeof this._buffer=="string"&&this._buffer.startsWith("data:"))t.base64String=this._buffer,t.name=t.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const h=this.mimeType||"image/png";t.base64String=`data:${h};base64,${Y(this._buffer)}`}else(s.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?Z(this):X(this));return t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,s._SerializeInternalTextureUniqueId&&(t.internalTextureUniqueId=(i=this._texture)==null?void 0:i.uniqueId),t.internalTextureLabel=(a=this._texture)==null?void 0:a.label,t.noMipmap=this._noMipmap,this.name=e,t}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,i){if(e.customType){const r=k.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&r.updateSamplingMode&&r._samplingMode&&r._samplingMode!==e.samplingMode&&r.updateSamplingMode(e.samplingMode),r}if(e.isCube&&!e.isRenderTarget)return s._CubeTextureParser(e,t,i);const a=e.internalTextureUniqueId!==void 0;if(!e.name&&!e.isRenderTarget&&!a)return null;let h;if(a){const n=t.getEngine().getLoadedTexturesCache();for(const r of n)if(r.uniqueId===e.internalTextureUniqueId){h=r;break}}const _=n=>{if(n&&n._texture&&(n._texture._cachedWrapU=null,n._texture._cachedWrapV=null,n._texture._cachedWrapR=null),e.samplingMode){const r=e.samplingMode;n&&n.samplingMode!==r&&n.updateSamplingMode(r)}if(n&&e.animations)for(let r=0;r<e.animations.length;r++){const u=e.animations[r],c=q("BABYLON.Animation");c&&n.animations.push(c.Parse(u))}n&&n._texture&&(a&&!h&&n._texture._setUniqueId(e.internalTextureUniqueId),n._texture.label=e.internalTextureLabel)};return b.Parse(()=>{let n=!0;if(e.noMipmap&&(n=!1),e.mirrorPlane){const r=s._CreateMirror(e.name,e.renderTargetSize,t,n);return r._waitingRenderList=e.renderList,r.mirrorPlane=j.FromArray(e.mirrorPlane),_(r),r}else if(e.isRenderTarget){let r=null;if(e.isCube){if(t.reflectionProbes)for(let u=0;u<t.reflectionProbes.length;u++){const c=t.reflectionProbes[u];if(c.name===e.name)return c.cubeTexture}}else r=s._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,n,e._creationFlags??0),r._waitingRenderList=e.renderList;return _(r),r}else if(e.isVideo){const r=s._CreateVideoTexture(i+(e.url||e.name),i+(e.src||e.url),t,n,e.invertY,e.samplingMode,e.settings||{});return _(r),r}else{let r;if(e.base64String&&!h)r=s.CreateFromBase64String(e.base64String,e.base64String,t,!n,e.invertY,e.samplingMode,()=>{_(r)},e._creationFlags??0,e._useSRGBBuffer??!1),r.name=e.name;else{let u;e.name&&(e.name.indexOf("://")>0||e.name.startsWith("data:"))?u=e.name:u=i+e.name,e.url&&(e.url.startsWith("data:")||s.UseSerializedUrlIfAny)&&(u=e.url);const c={noMipmap:!n,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{_(r)},internalTexture:h};r=new s(u,t,c)}return r}},e,t)}static CreateFromBase64String(e,t,i,a,h,_=s.TRILINEAR_SAMPLINGMODE,f=null,n=null,r=5,u,c){return new s("data:"+t,i,a,h,_,f,n,e,!1,r,void 0,void 0,u,c)}static LoadFromDataString(e,t,i,a=!1,h,_=!0,f=s.TRILINEAR_SAMPLINGMODE,n=null,r=null,u=5,c,R){return e.substring(0,5)!=="data:"&&(e="data:"+e),new s(e,i,h,_,f,n,r,t,a,u,void 0,void 0,c,R)}}s.SerializeBuffers=!0;s.ForceSerializeBuffers=!1;s.OnTextureLoadErrorObservable=new U;s._SerializeInternalTextureUniqueId=!1;s._CubeTextureParser=(g,e,t)=>{throw C("CubeTexture")};s._CreateMirror=(g,e,t,i)=>{throw C("MirrorTexture")};s._CreateRenderTargetTexture=(g,e,t,i,a)=>{throw C("RenderTargetTexture")};s.NEAREST_SAMPLINGMODE=1;s.NEAREST_NEAREST_MIPLINEAR=8;s.BILINEAR_SAMPLINGMODE=2;s.LINEAR_LINEAR_MIPNEAREST=11;s.TRILINEAR_SAMPLINGMODE=3;s.LINEAR_LINEAR_MIPLINEAR=3;s.NEAREST_NEAREST_MIPNEAREST=4;s.NEAREST_LINEAR_MIPNEAREST=5;s.NEAREST_LINEAR_MIPLINEAR=6;s.NEAREST_LINEAR=7;s.NEAREST_NEAREST=1;s.LINEAR_NEAREST_MIPNEAREST=9;s.LINEAR_NEAREST_MIPLINEAR=10;s.LINEAR_LINEAR=2;s.LINEAR_NEAREST=12;s.EXPLICIT_MODE=0;s.SPHERICAL_MODE=1;s.PLANAR_MODE=2;s.CUBIC_MODE=3;s.PROJECTION_MODE=4;s.SKYBOX_MODE=5;s.INVCUBIC_MODE=6;s.EQUIRECTANGULAR_MODE=7;s.FIXED_EQUIRECTANGULAR_MODE=8;s.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;s.CLAMP_ADDRESSMODE=0;s.WRAP_ADDRESSMODE=1;s.MIRROR_ADDRESSMODE=2;s.UseSerializedUrlIfAny=!1;o([l()],s.prototype,"url",void 0);o([l()],s.prototype,"uOffset",void 0);o([l()],s.prototype,"vOffset",void 0);o([l()],s.prototype,"uScale",void 0);o([l()],s.prototype,"vScale",void 0);o([l()],s.prototype,"uAng",void 0);o([l()],s.prototype,"vAng",void 0);o([l()],s.prototype,"wAng",void 0);o([l()],s.prototype,"uRotationCenter",void 0);o([l()],s.prototype,"vRotationCenter",void 0);o([l()],s.prototype,"wRotationCenter",void 0);o([l()],s.prototype,"homogeneousRotationInUVTransform",void 0);o([l()],s.prototype,"isBlocking",null);H("BABYLON.Texture",s);b._TextureParser=s.Parse;export{d as B,s as T};
